<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
	</head>
	<body>
	<script src="https://cdn.jsdelivr.net/npm/idb@3.0.2/build/idb.min.js"></script>

	<div>
		<label for="email">adres email</label>
		<input id="email" placeholder="jan@example.com" type="email" required>
	</div>
	<div>
		<label for="kod_pocztowy">kod pocztowy</label>
		<input id="kod_pocztowy" placeholder="91-400" pattern="^[0-9]{2}-[0-9]{3}$" type="text" required>
	</div>
	<div>
		<label for="numer_nip">numer nip</label>
		<input id="numer_nip" placeholder="701-249-82-16" pattern="^[0-9]{3}-[0-9]{3}-[0-9]{2}-[0-9]{2}$" type="text" required>
	</div>
	<div>
		<label for="numer_dowodu">numer dowodu</label>
		<input id="numer_dowodu" placeholder="CAQ123456" pattern="^[A-Z]{3}[0-9]{6}$" type="text" required>
	</div>
	<div>
		<label for="numer_telefonu">numer telefonu</label>
		<input id="numer_telefonu" placeholder="123456789" type="tel" pattern="^[0-9]{9}$" required>
	</div>

	<div>
		<button onClick="wypelnijDane()">Wype≈Çnij pola poprawnymi danymi</button>
	</div>


	
<button onclick="dodajKontrachenta()">Dodaj kontrachenta</button>
<button onclick="usunKontrachentow()">Usun kontrachentow</button>

<p>Kontrachenci:</p>

<ul id="listElem"></ul>

<script>
		let db;

		init();

		async function init() {
		  db = await idb.openDb('clientDb2', 1, db => {
			clientObject = db.createObjectStore('client', {keyPath: 'name'});
		  });

		  list();
		}
	
		async function list() {
		  let tx = db.transaction('client');
		  let clientStore = tx.objectStore('client');

		  let clients = await clientStore.getAll();

		  if (clients.length) {
			listElem.innerHTML = clients.map(client => `<li>
				name: ${client.email}, price: ${client.kod_pocztowy} , price: ${client.numer_nip}, price: ${client.numer_dowodu},  price: ${client.numer_telefonu}
			  </li>`).join('');
		  } else {
			listElem.innerHTML = '<li>Brak kontrachentow</li>'
		  }


		}

		async function usunKontrachentow() {
		  let tx = db.transaction('client', 'readwrite');
		  await tx.objectStore('client').clear();
		  await list();
		}
		
		function sprawdzPoprawnosc(){
			formInputs = new Array(document.getElementById("email"),
			document.getElementById("kod_pocztowy"),
			document.getElementById("numer_nip"),
			document.getElementById("numer_dowodu"),
			document.getElementById("numer_telefonu"));
			bad=true;
            for (input of formInputs){
				if (!input.checkValidity()) {
				bad=false;
                    input.style.border = "1px solid red";
                }
                else {
                    input.style.border = "1px solid green";
                }
            }
			return bad;
			
		}
		
		function wypelnijDane(){
			document.getElementById("email").value = "jan@example.com";
			document.getElementById("kod_pocztowy").value= "91-400";
			document.getElementById("numer_nip").value= "701-249-82-16";
			document.getElementById("numer_dowodu").value= "CAQ123456";
			document.getElementById("numer_telefonu").value= "123456789";
		}
		
		 function dodajKontrachenta() {
			if(sprawdzPoprawnosc()==false){
				alert("zle dane.");  
				return;
			}
		  
			let email=document.getElementById("email");
			let kod_pocztowy=document.getElementById("kod_pocztowy");
			let numer_nip=document.getElementById("numer_nip");
			let numer_dowodu=document.getElementById("numer_dowodu");
			let numer_telefonu=document.getElementById("numer_telefonu");
			
		  let tx = db.transaction('client', 'readwrite');

		  try {
			 tx.objectStore('client').add({email, kod_pocztowy, numer_nip,numer_dowodu,numer_telefonu});
			 list();
		  } catch(err) {
			if (err.name == 'ConstraintError') {
			  alert("Such book exists already");
			  addBook();
			} else {
			  throw err;
			}
		  }
		}

		window.addEventListener('unhandledrejection', event => {
		  alert("Error: " + event.reason.message);
		});

		</script>
	</body>
</html>
