<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
	</head>
	<body>
	<script src="https://cdn.jsdelivr.net/npm/idb@3.0.2/build/idb.min.js"></script>

<button onclick="dodajKontrachenta()">Dodaj kontrachenta</button>
<button onclick="usunKontrachentow()">Clear books</button>

<p>Kontrachenci:</p>

<ul id="listElem"></ul>

<script>
		let db;

		init();

		async function init() {
		  db = await idb.openDb('clientDb1', 1, db => {
			clientObject = db.createObjectStore('client', {keyPath: 'name'});
		  });

		  list();
		}

		async function list() {
		  let tx = db.transaction('client');
		  let clientStore = tx.objectStore('client');

		  let clients = await clientStore.getAll();

		  if (clients.length) {
			listElem.innerHTML = clients.map(client => `<li>
				name: ${client.name}, price: ${client.phone} , price: ${client.address}
			  </li>`).join('');
		  } else {
			listElem.innerHTML = '<li>No clients yet. Please add clients.</li>'
		  }


		}

		async function usunKontrachentow() {
		  let tx = db.transaction('client', 'readwrite');
		  await tx.objectStore('client').clear();
		  await list();
		}

		 function dodajKontrachenta() {
		  let name = prompt("Client name?");
		  let phone = prompt("Client phone?");
		  let address = prompt("Client addresss?");
			
		  let tx = db.transaction('client', 'readwrite');

		  try {
			 tx.objectStore('client').add({name, phone, address});
			 list();
		  } catch(err) {
			if (err.name == 'ConstraintError') {
			  alert("Such book exists already");
			  addBook();
			} else {
			  throw err;
			}
		  }
		}

		window.addEventListener('unhandledrejection', event => {
		  alert("Error: " + event.reason.message);
		});

		</script>
	</body>
</html>
