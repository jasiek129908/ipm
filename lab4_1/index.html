<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<style>
			#contractor{
				background-color: #a0e1e7;
				display: inline-block;
  				width: 50px;
				width: 150px;
			}
		</style>
	</head>
	<body>
	
	<div>
		<label for="name">imie i nazwisko</label>
		<input id="name" placeholder="jan kowalski" type="text" required>
	</div>
	<div>
		<label for="email">adres email</label>
		<input id="email" placeholder="jan@example.com" type="email" required>
	</div>
	<div>
		<label for="kod_pocztowy">kod pocztowy</label>
		<input id="kod_pocztowy" placeholder="91-400" pattern="^[0-9]{2}-[0-9]{3}$" type="text" required>
	</div>
	<div>
		<label for="numer_nip">nip</label>
		<input id="numer_nip" placeholder="701-249-82-16" pattern="^[0-9]{3}-[0-9]{3}-[0-9]{2}-[0-9]{2}$" type="text" required>
	</div>
	<div>
		<label for="numer_dowodu">dowod</label>
		<input id="numer_dowodu" placeholder="CAQ123456" pattern="^[A-Z]{3}[0-9]{6}$" type="text" required>
	</div>
	<div>
		<label for="numer_telefonu">telefon</label>
		<input id="numer_telefonu" placeholder="123456789" type="tel" pattern="^[0-9]{9}$" required>
	</div>

	<div>
		<button onClick="wypelnijDane()">Wype≈Çnij pola poprawnymi danymi</button>
	</div>


	
<button onclick="dodajKontrachenta()">Dodaj kontrachenta</button>
<button onclick="usunKontrachentow()">Usun kontrachentow</button>

<p>Kontrachenci:</p>

<ul id="listElem"></ul>

<script>
		var db;
        const request = indexedDB.open('database12');
        request.onsuccess = function (event) {
            db = request.result;
        };

        request.onupgradeneeded = (event) => {
            db = event.target.result;
            let store = db.createObjectStore('client', {autoIncrement: true});
        };
	
		async function list() {
		  let tx = db.transaction('client');
		  let clientStore = tx.objectStore('client');

		  clientStore.getAll().onsuccess = function(event) {
				if (event.target.result.length) {
				listElem.innerHTML = event.target.result.map(client => `<li>
					imie: <span id="contractor">${client.name}</span>, email: <span id="contractor">${client.email}</span>
					, kod_pocztowy: <span id="contractor">${client.kod_pocztowy}</span>, numer nip: <span id="contractor">${client.numer_nip}</span>
					, numer dowodu: <span id="contractor">${client.numer_dowodu}</span>,  number telefonu: 
					<span id="contractor">${client.numer_telefonu}</span>
				  </li></br>`).join('');
			  } else {
				listElem.innerHTML = '<li>Brak kontrachentow</li>'
			  }
			};

		}

		async function usunKontrachentow() {
		  let tx = db.transaction('client', 'readwrite');
		  await tx.objectStore('client').clear();
		  await list();
		}
		
		 function dodajKontrachenta() {
			if(sprawdzPoprawnosc()==false){
				alert("zle dane.");  
				return;
			}
		  let tx = db.transaction(["client"], "readwrite");
		  try {
			  
					tx.objectStore("client")
					.add({
						name:document.getElementById("name").value,
						email:document.getElementById("email").value,
						kod_pocztowy:document.getElementById("kod_pocztowy").value,
						numer_nip:document.getElementById("numer_nip").value,
						numer_dowodu:document.getElementById("numer_dowodu").value,
						numer_telefonu:document.getElementById("numer_telefonu").value
					});
				console.log("dodalem");
			 list();
		  } catch(err) {
			if (err.name == 'ConstraintError') {
			  alert("Such book exists already");
			  addBook();
			} else {
			  throw err;
			}
		  }
		}

		window.addEventListener('unhandledrejection', event => {
		  alert("Error: " + event.reason.message);
		});

		var listOfContractors = [
			{name:"Jan Kowalski",email:"jan@wp.pl",kod_pocztowy:"80-201",numer_nip:"101-249-82-16",numer_dowodu:"CAQ123456",numer_telefonu:"123456789"},
			{name:"Adam Cichawa",email:"adam@wp.pl",kod_pocztowy:"43-201",numer_nip:"211-249-82-16",numer_dowodu:"BEQ546543",numer_telefonu:"145465472"},
			{name:"Ryszard Kalisz",email:"ryszard@wp.pl",kod_pocztowy:"65-201",numer_nip:"321-249-82-16",numer_dowodu:"QAF889432",numer_telefonu:"983274671"},
			{name:"Monika Dabrowksa",email:"monika@wp.pl",kod_pocztowy:"10-201",numer_nip:"431-249-82-16",numer_dowodu:"VKO513241",numer_telefonu:"619233732"},
			{name:"Artur Stanczyk",email:"artur@wp.pl",kod_pocztowy:"28-201",numer_nip:"541-249-82-16",numer_dowodu:"OIU987954",numer_telefonu:"904837613"},
			{name:"Weronika Lodyga",email:"weronika@wp.pl",kod_pocztowy:"45-201",numer_nip:"651-249-82-16",numer_dowodu:"VXD893745",numer_telefonu:"389472591"},
			{name:"Kuba Wojaterk",email:"kuba@wp.pl",kod_pocztowy:"12-201",numer_nip:"761-249-82-16",numer_dowodu:"NIJ093845",numer_telefonu:"435871822"},
			{name:"Szczepan Wieszcz",email:"szczepan@wp.pl",kod_pocztowy:"33-201",numer_nip:"871-249-82-16",numer_dowodu:"OIY098234",numer_telefonu:"329847123"},
			{name:"Natlia Kolatka",email:"natlia@wp.pl",kod_pocztowy:"98-201",numer_nip:"981-249-82-16",numer_dowodu:"GTY982734",numer_telefonu:"981273124"}
		];
		var indexOfLastRead = 0;

		function sprawdzPoprawnosc(){
			formInputs = new Array(document.getElementById("name"),
			document.getElementById("email"),
			document.getElementById("kod_pocztowy"),
			document.getElementById("numer_nip"),
			document.getElementById("numer_dowodu"),
			document.getElementById("numer_telefonu"));
			bad=true;
            for (input of formInputs){
				if (!input.checkValidity()) {
				bad=false;
                    input.style.border = "1px solid red";
                }
                else {
                    input.style.border = "1px solid green";
                }
            }
			return bad;
			
		}
		
		function wypelnijDane(){

			if(indexOfLastRead < listOfContractors.length){
				let currentContractor = listOfContractors[indexOfLastRead];

				document.getElementById("name").value = currentContractor.name;
				document.getElementById("email").value = currentContractor.email;
				document.getElementById("kod_pocztowy").value= currentContractor.kod_pocztowy;
				document.getElementById("numer_nip").value= currentContractor.numer_nip;
				document.getElementById("numer_dowodu").value= currentContractor.numer_dowodu;
				document.getElementById("numer_telefonu").value= currentContractor.numer_telefonu;

				indexOfLastRead++;
			}else{
				indexOfLastRead=0;
			}
		}
		
		</script>
	</body>
</html>
